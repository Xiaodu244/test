<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºåº§ä½ç”Ÿæˆå™¨ï¼ˆè§„åˆ™é”å®šç‰ˆï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.544.0/dist/umd/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .app-container {
            width: 100vw;
            height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .seat-container {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            width: 100%;
            flex: 1;
            min-height: 0;
            margin: 10px 0;
        }
        
        .seat {
            aspect-ratio: 1.2;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            font-weight: 600;
            font-size: clamp(14px, 1.2vw, 18px);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            word-break: keep-all;
            padding: 5px;
        }
        
        .seat:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .controls {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 15px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: clamp(14px, 1vw, 16px);
        }
        
        .btn-primary {
            background: #4f46e5;
            color: white;
        }
        
        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .btn-export {
            background: #10b981;
            color: white;
        }
        
        .btn-export:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            background: #f8fafc;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .history-item:hover {
            background: #e2e8f0;
        }
        
        .settings-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        
        .setting-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 15px;
        }
        
        .setting-title {
            font-weight: 700;
            margin-bottom: 15px;
            color: #1e293b;
        }
        
        .student-selector {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .row-selector {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .restriction-pair {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .restriction-pair select {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .add-restriction-btn {
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .restriction-list {
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .restriction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: #e2e8f0;
            border-radius: 6px;
            margin-bottom: 5px;
        }
        
        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .fixed-seat-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        
        .fixed-seat-item {
            aspect-ratio: 1.2;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f1f5f9;
            border-radius: 6px;
            padding: 5px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
        }
        
        .fixed-seat-item.active {
            background: #4f46e5;
            color: white;
        }
        
        .fixed-seat-item:hover {
            background: #e2e8f0;
        }
        
        .fixed-seat-item.active:hover {
            background: #4338ca;
        }
        
        .fixed-seat {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
        }
        
        .time-display {
            color: white;
            font-size: clamp(14px, 1vw, 16px);
            font-weight: 500;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .header h1 {
            color: white;
            font-size: clamp(24px, 2vw, 32px);
            font-weight: 700;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: #64748b;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1001;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #10b981;
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .export-success {
            text-align: center;
            padding: 20px;
        }
        
        .export-success h3 {
            color: #10b981;
            margin-bottom: 10px;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.mb-4{margin-bottom:1rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.flex{display:flex}.w-full{width:100%}.gap-3{gap:0.75rem}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.text-2xl{font-size:1.5rem;line-height:2rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}</style></head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“ éšæœºåº§ä½ç”Ÿæˆå™¨</h1>
            <div class="flex gap-3">
                <button id="settingsBtn" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="settings" class="lucide lucide-settings"><path d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    è®¾ç½®
                </button>
                <button id="exportBtn" class="btn btn-export">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="download" class="lucide lucide-download"><path d="M12 15V3"></path><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><path d="m7 10 5 5 5-5"></path></svg>
                    å¯¼å‡ºé”å®šè§„åˆ™çš„ç½‘é¡µ
                </button>
                <button id="historyBtn" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="history" class="lucide lucide-history"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M12 7v5l4 2"></path></svg>
                    å†å²è®°å½•
                </button>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="flex gap-3">
                <button id="generateBtn" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="refresh-cw" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg>
                    ç”Ÿæˆéšæœºåº§ä½
                </button>
                <button id="saveBtn" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="save" class="lucide lucide-save"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"></path><path d="M7 3v4a1 1 0 0 0 1 1h7"></path></svg>
                    ä¿å­˜å½“å‰åº§ä½
                </button>
            </div>
            <div class="time-display">
                å½“å‰æ—¶é—´: <span id="currentTime">2025/12/14 18:10:31</span>
            </div>
        </div>

        <!-- Seat Grid -->
        <div class="seat-container" id="seatContainer"><div class="seat">è¢ä¼Ÿæ°</div><div class="seat">é»„æˆŸ</div><div class="seat">ä¹”å…°æƒ </div><div class="seat">é‚¹è°¨ç¾½</div><div class="seat">å´è‡»</div><div class="seat">éƒ­æ–‡ç†™</div><div class="seat">æèŠ·æ¼©</div><div class="seat">æ¢æ´ªæ»”</div><div class="seat">ä¼ä¿Šé›¯</div><div class="seat">é»„æ–‡æ¡¢</div><div class="seat">é™ˆä¿Šæ± </div><div class="seat">å¼ æ’çƒ¨</div><div class="seat">ä½•ç«‹æ—</div><div class="seat">è”¡æ¾é˜³</div><div class="seat">èƒ¡å®¶æº</div><div class="seat">å¸¸å‡¯è¿ª</div><div class="seat">æ½˜ä¸½çƒ¨</div><div class="seat">åŒ…åšæ–‡</div><div class="seat">ç®€æ–‡æ›¦</div><div class="seat">ç”°æ·»</div><div class="seat">é©¬æ¢“é“­</div><div class="seat">æ¨é¹èˆª</div><div class="seat">ä½•ä¿Šæ°</div><div class="seat">è°­è¯—è’™</div><div class="seat">è°­åŠ›è±ª</div><div class="seat">é™ˆèŠƒé”¦</div><div class="seat">å†¯æ‚ ç„¶</div><div class="seat">åˆ˜æ˜±åŒ</div><div class="seat">èµµè‹“æ·‡</div><div class="seat">é¾™æ³³å¸Œ</div><div class="seat">é«˜å¯èˆª</div><div class="seat">ç‹å‡¡äºˆ</div><div class="seat">èŒƒé‚µå‡¯</div><div class="seat">å†‰é«˜è¶Šæ‰¬</div><div class="seat">é‚¹é›¨æˆ</div><div class="seat">æœæ³“éª</div><div class="seat">å¼ å…ƒå…®</div><div class="seat">é™ˆè§‰ç† </div><div class="seat">åˆ˜æ²›å‡</div><div class="seat">ç§¦æ¢“èˆª</div><div class="seat">æ½˜æ…§å¦</div><div class="seat">æ±ªå­é€š</div><div class="seat">æå¹¿ä¸€</div><div class="seat">ç‹ä¸€å©·</div><div class="seat">ç‹å¼˜æ¯…</div><div class="seat">å¼ åº­é“­</div><div class="seat">ä½•é›¨æ¡€</div><div class="seat">é™ˆä¿éœ–</div><div class="seat fixed-seat">é¢œå±¿è˜…</div><div class="seat fixed-seat">å´ä¼˜</div><div class="seat">æ•–å¯…è½©</div><div class="seat">ç‹äº‘ç¿”</div><div class="seat">ä¸‡æ‰¿æº</div><div class="seat">æ¢å…æ³½</div><div class="seat">æ¨çš“ç„¶</div><div class="seat">æå¼˜æ¯…</div></div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">å†å²è®°å½•</h2>
                <button onclick="closeHistoryModal()" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                </button>
            </div>
            <div id="historyList" class="space-y-2">
                <!-- History items will be generated here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div id="passwordPrompt" style="display: none;">
                <div class="modal-header">
                    <h2 class="text-2xl font-bold">éªŒè¯èº«ä»½</h2>
                    <button onclick="closeSettingsModal()" class="modal-close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                    </button>
                </div>
                <h3 class="text-lg font-semibold mb-4">è¯·è¾“å…¥å¯†ç </h3>
                <input type="password" id="passwordInput" class="student-selector" placeholder="è¾“å…¥å¯†ç ">
                <button onclick="checkPassword()" class="btn btn-primary mt-4 w-full">ç¡®è®¤</button>
            </div>
            
            <div id="settingsContent" style="display: block;">
                <div class="modal-header">
                    <h2 class="text-2xl font-bold">åº§ä½è®¾ç½®</h2>
                    <button onclick="closeSettingsModal()" class="modal-close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                    </button>
                </div>
                
                <div class="settings-grid">
                    <!-- è¡Œé™åˆ¶è®¾ç½® -->
                    <div class="setting-section">
                        <div class="setting-title">1. è¡Œé™åˆ¶</div>
                        <select id="rowRestrictionStudent" class="student-selector">
                            <option value="">é€‰æ‹©å­¦ç”Ÿ</option>
                        <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                        <select id="rowRestrictionRow" class="row-selector">
                            <option value="">é€‰æ‹©å›ºå®šè¡Œ</option>
                            <option value="0">ç¬¬1è¡Œ</option>
                            <option value="1">ç¬¬2è¡Œ</option>
                            <option value="2">ç¬¬3è¡Œ</option>
                            <option value="3">ç¬¬4è¡Œ</option>
                            <option value="4">ç¬¬5è¡Œ</option>
                            <option value="5">ç¬¬6è¡Œ</option>
                            <option value="6">ç¬¬7è¡Œ</option>
                        </select>
                        <button class="add-restriction-btn" onclick="addRowRestriction()">æ·»åŠ è¡Œé™åˆ¶</button>
                        <div id="rowRestrictionList" class="restriction-list"></div>
                    </div>

                    <!-- ç›¸é‚»é™åˆ¶è®¾ç½® -->
                    <div class="setting-section">
                        <div class="setting-title">2. ç›¸é‚»é™åˆ¶ï¼ˆå·¦å³ä¸èƒ½æŒ¨ç€ï¼‰</div>
                        <div class="restriction-pair">
                            <select id="adjacentStudent1" class="student-selector">
                                <option value="">é€‰æ‹©å­¦ç”ŸA</option>
                            <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                            <select id="adjacentStudent2" class="student-selector">
                                <option value="">é€‰æ‹©å­¦ç”ŸB</option>
                            <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                        </div>
                        <button class="add-restriction-btn" onclick="addAdjacentRestriction()">æ·»åŠ ç›¸é‚»é™åˆ¶</button>
                        <div id="adjacentRestrictionList" class="restriction-list"></div>
                    </div>

                    <!-- å‰åæ¡Œé™åˆ¶è®¾ç½® -->
                    <div class="setting-section">
                        <div class="setting-title">3. å‰åæ¡Œé™åˆ¶ï¼ˆå‰åä¸èƒ½æŒ¨ç€ï¼‰</div>
                        <div class="restriction-pair">
                            <select id="frontBackStudent1" class="student-selector">
                                <option value="">é€‰æ‹©å­¦ç”ŸA</option>
                            <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                            <select id="frontBackStudent2" class="student-selector">
                                <option value="">é€‰æ‹©å­¦ç”ŸB</option>
                            <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                        </div>
                        <button class="add-restriction-btn" onclick="addFrontBackRestriction()">æ·»åŠ å‰åæ¡Œé™åˆ¶</button>
                        <div id="frontBackRestrictionList" class="restriction-list"></div>
                    </div>

                    <!-- å¼ºåˆ¶åŒæ¡Œè§„åˆ™è®¾ç½® -->
                    <div class="setting-section">
                        <div class="setting-title">4. å¼ºåˆ¶åŒæ¡Œè§„åˆ™ï¼ˆå¿…é¡»ååœ¨ä¸€èµ·ï¼‰</div>
                        <div class="restriction-pair">
                            <select id="deskmateStudent1" class="student-selector">
                                <option value="">é€‰æ‹©å­¦ç”ŸA</option>
                            <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                            <select id="deskmateStudent2" class="student-selector">
                                <option value="">é€‰æ‹©å­¦ç”ŸB</option>
                            <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                        </div>
                        <button class="add-restriction-btn" onclick="addDeskmateRestriction()">æ·»åŠ å¼ºåˆ¶åŒæ¡Œ</button>
                        <div id="deskmateRestrictionList" class="restriction-list"><div class="restriction-item">
                        <span>åŒ…åšæ–‡ å’Œ æ½˜ä¸½çƒ¨ å¿…é¡»ååŒæ¡Œ</span>
                        <button class="remove-btn" onclick="removeDeskmateRestriction(0)">åˆ é™¤</button>
                    </div></div>
                    </div>

                    <!-- å›ºå®šåº§ä½è®¾ç½® -->
                    <div class="setting-section">
                        <div class="setting-title">5. å›ºå®šåº§ä½</div>
                        <select id="fixedSeatStudent" class="student-selector">
                            <option value="">é€‰æ‹©å­¦ç”Ÿ</option>
                        <option value="æ•–å¯…è½©">æ•–å¯…è½©</option><option value="åŒ…åšæ–‡">åŒ…åšæ–‡</option><option value="è”¡æ¾é˜³">è”¡æ¾é˜³</option><option value="å¸¸å‡¯è¿ª">å¸¸å‡¯è¿ª</option><option value="é™ˆè§‰ç† ">é™ˆè§‰ç† </option><option value="é™ˆä¿Šæ± ">é™ˆä¿Šæ± </option><option value="é™ˆèŠƒé”¦">é™ˆèŠƒé”¦</option><option value="é™ˆä¿éœ–">é™ˆä¿éœ–</option><option value="æœæ³“éª">æœæ³“éª</option><option value="èŒƒé‚µå‡¯">èŒƒé‚µå‡¯</option><option value="å†¯æ‚ ç„¶">å†¯æ‚ ç„¶</option><option value="ä¼ä¿Šé›¯">ä¼ä¿Šé›¯</option><option value="é«˜å¯èˆª">é«˜å¯èˆª</option><option value="éƒ­æ–‡ç†™">éƒ­æ–‡ç†™</option><option value="ä½•ä¿Šæ°">ä½•ä¿Šæ°</option><option value="ä½•ç«‹æ—">ä½•ç«‹æ—</option><option value="ä½•é›¨æ¡€">ä½•é›¨æ¡€</option><option value="èƒ¡å®¶æº">èƒ¡å®¶æº</option><option value="é»„æˆŸ">é»„æˆŸ</option><option value="é»„æ–‡æ¡¢">é»„æ–‡æ¡¢</option><option value="ç®€æ–‡æ›¦">ç®€æ–‡æ›¦</option><option value="æå¹¿ä¸€">æå¹¿ä¸€</option><option value="æå¼˜æ¯…">æå¼˜æ¯…</option><option value="æèŠ·æ¼©">æèŠ·æ¼©</option><option value="æ¢æ´ªæ»”">æ¢æ´ªæ»”</option><option value="æ¢å…æ³½">æ¢å…æ³½</option><option value="åˆ˜æ²›å‡">åˆ˜æ²›å‡</option><option value="åˆ˜æ˜±åŒ">åˆ˜æ˜±åŒ</option><option value="é¾™æ³³å¸Œ">é¾™æ³³å¸Œ</option><option value="é©¬æ¢“é“­">é©¬æ¢“é“­</option><option value="æ½˜æ…§å¦">æ½˜æ…§å¦</option><option value="æ½˜ä¸½çƒ¨">æ½˜ä¸½çƒ¨</option><option value="ä¹”å…°æƒ ">ä¹”å…°æƒ </option><option value="ç§¦æ¢“èˆª">ç§¦æ¢“èˆª</option><option value="å†‰é«˜è¶Šæ‰¬">å†‰é«˜è¶Šæ‰¬</option><option value="è°­åŠ›è±ª">è°­åŠ›è±ª</option><option value="è°­è¯—è’™">è°­è¯—è’™</option><option value="ç”°æ·»">ç”°æ·»</option><option value="ä¸‡æ‰¿æº">ä¸‡æ‰¿æº</option><option value="æ±ªå­é€š">æ±ªå­é€š</option><option value="ç‹å‡¡äºˆ">ç‹å‡¡äºˆ</option><option value="ç‹å¼˜æ¯…">ç‹å¼˜æ¯…</option><option value="ç‹ä¸€å©·">ç‹ä¸€å©·</option><option value="ç‹äº‘ç¿”">ç‹äº‘ç¿”</option><option value="å´ä¼˜">å´ä¼˜</option><option value="å´è‡»">å´è‡»</option><option value="é¢œå±¿è˜…">é¢œå±¿è˜…</option><option value="æ¨çš“ç„¶">æ¨çš“ç„¶</option><option value="æ¨é¹èˆª">æ¨é¹èˆª</option><option value="è¢ä¼Ÿæ°">è¢ä¼Ÿæ°</option><option value="å¼ æ’çƒ¨">å¼ æ’çƒ¨</option><option value="å¼ åº­é“­">å¼ åº­é“­</option><option value="å¼ å…ƒå…®">å¼ å…ƒå…®</option><option value="èµµè‹“æ·‡">èµµè‹“æ·‡</option><option value="é‚¹è°¨ç¾½">é‚¹è°¨ç¾½</option><option value="é‚¹é›¨æˆ">é‚¹é›¨æˆ</option></select>
                        <div id="fixedSeatGrid" class="fixed-seat-grid"><div class="fixed-seat-item" data-position="0">1è¡Œ1åˆ—</div><div class="fixed-seat-item" data-position="1">1è¡Œ2åˆ—</div><div class="fixed-seat-item" data-position="2">1è¡Œ3åˆ—</div><div class="fixed-seat-item" data-position="3">1è¡Œ4åˆ—</div><div class="fixed-seat-item" data-position="4">1è¡Œ5åˆ—</div><div class="fixed-seat-item" data-position="5">1è¡Œ6åˆ—</div><div class="fixed-seat-item" data-position="6">1è¡Œ7åˆ—</div><div class="fixed-seat-item" data-position="7">1è¡Œ8åˆ—</div><div class="fixed-seat-item" data-position="8">2è¡Œ1åˆ—</div><div class="fixed-seat-item" data-position="9">2è¡Œ2åˆ—</div><div class="fixed-seat-item" data-position="10">2è¡Œ3åˆ—</div><div class="fixed-seat-item" data-position="11">2è¡Œ4åˆ—</div><div class="fixed-seat-item" data-position="12">2è¡Œ5åˆ—</div><div class="fixed-seat-item" data-position="13">2è¡Œ6åˆ—</div><div class="fixed-seat-item" data-position="14">2è¡Œ7åˆ—</div><div class="fixed-seat-item" data-position="15">2è¡Œ8åˆ—</div><div class="fixed-seat-item" data-position="16">3è¡Œ1åˆ—</div><div class="fixed-seat-item" data-position="17">3è¡Œ2åˆ—</div><div class="fixed-seat-item" data-position="18">3è¡Œ3åˆ—</div><div class="fixed-seat-item" data-position="19">3è¡Œ4åˆ—</div><div class="fixed-seat-item" data-position="20">3è¡Œ5åˆ—</div><div class="fixed-seat-item" data-position="21">3è¡Œ6åˆ—</div><div class="fixed-seat-item" data-position="22">3è¡Œ7åˆ—</div><div class="fixed-seat-item" data-position="23">3è¡Œ8åˆ—</div><div class="fixed-seat-item" data-position="24">4è¡Œ1åˆ—</div><div class="fixed-seat-item" data-position="25">4è¡Œ2åˆ—</div><div class="fixed-seat-item" data-position="26">4è¡Œ3åˆ—</div><div class="fixed-seat-item" data-position="27">4è¡Œ4åˆ—</div><div class="fixed-seat-item" data-position="28">4è¡Œ5åˆ—</div><div class="fixed-seat-item" data-position="29">4è¡Œ6åˆ—</div><div class="fixed-seat-item" data-position="30">4è¡Œ7åˆ—</div><div class="fixed-seat-item" data-position="31">4è¡Œ8åˆ—</div><div class="fixed-seat-item" data-position="32">5è¡Œ1åˆ—</div><div class="fixed-seat-item" data-position="33">5è¡Œ2åˆ—</div><div class="fixed-seat-item" data-position="34">5è¡Œ3åˆ—</div><div class="fixed-seat-item" data-position="35">5è¡Œ4åˆ—</div><div class="fixed-seat-item" data-position="36">5è¡Œ5åˆ—</div><div class="fixed-seat-item" data-position="37">5è¡Œ6åˆ—</div><div class="fixed-seat-item" data-position="38">5è¡Œ7åˆ—</div><div class="fixed-seat-item" data-position="39">5è¡Œ8åˆ—</div><div class="fixed-seat-item" data-position="40">6è¡Œ1åˆ—</div><div class="fixed-seat-item" data-position="41">6è¡Œ2åˆ—</div><div class="fixed-seat-item" data-position="42">6è¡Œ3åˆ—</div><div class="fixed-seat-item" data-position="43">6è¡Œ4åˆ—</div><div class="fixed-seat-item" data-position="44">6è¡Œ5åˆ—</div><div class="fixed-seat-item" data-position="45">6è¡Œ6åˆ—</div><div class="fixed-seat-item" data-position="46">6è¡Œ7åˆ—</div><div class="fixed-seat-item" data-position="47">6è¡Œ8åˆ—</div><div class="fixed-seat-item active" data-position="48">é¢œå±¿è˜…</div><div class="fixed-seat-item active" data-position="49">å´ä¼˜</div><div class="fixed-seat-item" data-position="50">7è¡Œ3åˆ—</div><div class="fixed-seat-item" data-position="51">7è¡Œ4åˆ—</div><div class="fixed-seat-item" data-position="52">7è¡Œ5åˆ—</div><div class="fixed-seat-item" data-position="53">7è¡Œ6åˆ—</div><div class="fixed-seat-item" data-position="54">7è¡Œ7åˆ—</div><div class="fixed-seat-item" data-position="55">7è¡Œ8åˆ—</div></div>
                        <div id="fixedSeatList" class="restriction-list"><div class="restriction-item">
                        <span>å´ä¼˜ å›ºå®šåœ¨7è¡Œ2åˆ—</span>
                        <button class="remove-btn" onclick="removeFixedSeat(0)">åˆ é™¤</button>
                    </div><div class="restriction-item">
                        <span>é¢œå±¿è˜… å›ºå®šåœ¨7è¡Œ1åˆ—</span>
                        <button class="remove-btn" onclick="removeFixedSeat(1)">åˆ é™¤</button>
                    </div></div>
                    </div>
                </div>
                
                <button class="btn btn-primary mt-6 w-full" onclick="saveAllSettings()">ä¿å­˜æ‰€æœ‰è®¾ç½®</button>
            </div>
        </div>
    </div>

    <!-- å¯¼å‡ºæˆåŠŸå¼¹çª— -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="export-success">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check-circle" style="font-size: 48px; color: #10b981;" class="lucide lucide-check-circle"><path d="M21.801 10A10 10 0 1 1 17 3.335"></path><path d="m9 11 3 3L22 4"></path></svg>
                <h3 class="text-xl font-bold mt-4">å¯¼å‡ºæˆåŠŸï¼</h3>
                <p class="text-gray-600 mt-2">å·²ç”ŸæˆåŒ…å«é”å®šè§„åˆ™çš„æ–°ç½‘é¡µæ–‡ä»¶</p>
                <p class="text-gray-500 text-sm mt-4">è¯¥æ–‡ä»¶å·²å°†å½“å‰æ‰€æœ‰è§„åˆ™æ°¸ä¹…é”å®šï¼Œæ‰“å¼€åæ— éœ€å†è®¾ç½®è§„åˆ™</p>
                <button class="btn btn-primary mt-6" onclick="closeExportModal()">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- Student Detail Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-2xl font-bold" id="studentModalTitle">å­¦ç”Ÿè¯¦æƒ…</h2>
                <button onclick="closeStudentModal()" class="modal-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                </button>
            </div>
            <div id="studentHistory" class="space-y-3">
                <!-- Student history will be generated here -->
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification success">æ‰€æœ‰è®¾ç½®å·²ä¿å­˜å¹¶ç”Ÿæ•ˆ</div>

    <script>
        // ======================== æ ¸å¿ƒé…ç½® ========================
        // é”å®šçš„è§„åˆ™ï¼ˆåœ¨å¯¼å‡ºçš„æ–‡ä»¶ä¸­ä¼šè¢«æ›¿æ¢ä¸ºå®é™…è®¾ç½®çš„è§„åˆ™ï¼‰
        const LOCKED_SETTINGS = {
    "isLocked": true,
    "rowRestrictions": [],
    "adjacentRestrictions": [],
    "frontBackRestrictions": [],
    "deskmateRestrictions": [
        {
            "student1": "åŒ…åšæ–‡",
            "student2": "æ½˜ä¸½çƒ¨"
        }
    ],
    "fixedSeats": [
        {
            "student": "å´ä¼˜",
            "position": 49
        },
        {
            "student": "é¢œå±¿è˜…",
            "position": 48
        }
    ]
};

        // å­¦ç”Ÿåå•
        const students = [
            'æ•–å¯…è½©', 'åŒ…åšæ–‡', 'è”¡æ¾é˜³', 'å¸¸å‡¯è¿ª', 'é™ˆè§‰ç† ', 'é™ˆä¿Šæ± ', 'é™ˆèŠƒé”¦', 'é™ˆä¿éœ–',
            'æœæ³“éª', 'èŒƒé‚µå‡¯', 'å†¯æ‚ ç„¶', 'ä¼ä¿Šé›¯', 'é«˜å¯èˆª', 'éƒ­æ–‡ç†™', 'ä½•ä¿Šæ°', 'ä½•ç«‹æ—',
            'ä½•é›¨æ¡€', 'èƒ¡å®¶æº', 'é»„æˆŸ', 'é»„æ–‡æ¡¢', 'ç®€æ–‡æ›¦', 'æå¹¿ä¸€', 'æå¼˜æ¯…', 'æèŠ·æ¼©',
            'æ¢æ´ªæ»”', 'æ¢å…æ³½', 'åˆ˜æ²›å‡', 'åˆ˜æ˜±åŒ', 'é¾™æ³³å¸Œ', 'é©¬æ¢“é“­', 'æ½˜æ…§å¦', 'æ½˜ä¸½çƒ¨',
            'ä¹”å…°æƒ ', 'ç§¦æ¢“èˆª', 'å†‰é«˜è¶Šæ‰¬', 'è°­åŠ›è±ª', 'è°­è¯—è’™', 'ç”°æ·»', 'ä¸‡æ‰¿æº', 'æ±ªå­é€š',
            'ç‹å‡¡äºˆ', 'ç‹å¼˜æ¯…', 'ç‹ä¸€å©·', 'ç‹äº‘ç¿”', 'å´ä¼˜', 'å´è‡»', 'é¢œå±¿è˜…', 'æ¨çš“ç„¶',
            'æ¨é¹èˆª', 'è¢ä¼Ÿæ°', 'å¼ æ’çƒ¨', 'å¼ åº­é“­', 'å¼ å…ƒå…®', 'èµµè‹“æ·‡', 'é‚¹è°¨ç¾½', 'é‚¹é›¨æˆ'
        ];

        // å…¨å±€å˜é‡
        let currentSeats = [];
        let history = [];
        let settings = LOCKED_SETTINGS.isLocked ? LOCKED_SETTINGS : {
            rowRestrictions: [],    
            adjacentRestrictions: [], 
            frontBackRestrictions: [], 
            deskmateRestrictions: [], // æ–°å¢ï¼šå¼ºåˆ¶åŒæ¡Œè§„åˆ™
            fixedSeats: []          
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            lucide.createIcons();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        });

        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            // å¦‚æœæ˜¯é”å®šç‰ˆæœ¬ï¼Œç¦ç”¨è®¾ç½®æŒ‰é’®å’Œå¯¼å‡ºæŒ‰é’®ï¼Œä¸æ˜¾ç¤ºä»»ä½•é”å®šæ ‡è®°
            if (LOCKED_SETTINGS.isLocked) {
                document.getElementById('settingsBtn').disabled = true;
                document.getElementById('settingsBtn').style.opacity = '0.6';
                document.getElementById('settingsBtn').title = 'å½“å‰ç‰ˆæœ¬è®¾ç½®ä¸å¯ç”¨';
                document.getElementById('exportBtn').style.display = 'none';
            } else {
                // éé”å®šç‰ˆæœ¬ï¼ŒåŠ è½½æœ¬åœ°å­˜å‚¨çš„è®¾ç½®
                loadSettings();
            }
            
            loadHistory();
            
            if (!LOCKED_SETTINGS.isLocked) {
                populateStudentSelectors();
                generateFixedSeatGrid();
                renderRestrictionLists();
            }
            
            generateRandomSeats();
        }

        // æ›´æ–°å½“å‰æ—¶é—´
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // ======================== è§„åˆ™è®¾ç½®ç›¸å…³åŠŸèƒ½ï¼ˆä»…éé”å®šç‰ˆæœ¬å¯ç”¨ï¼‰ ========================
        // å¡«å……å­¦ç”Ÿé€‰æ‹©å™¨
        function populateStudentSelectors() {
            const selectors = [
                'rowRestrictionStudent',
                'adjacentStudent1',
                'adjacentStudent2',
                'frontBackStudent1',
                'frontBackStudent2',
                'deskmateStudent1', // æ–°å¢ï¼šå¼ºåˆ¶åŒæ¡Œå­¦ç”ŸA
                'deskmateStudent2', // æ–°å¢ï¼šå¼ºåˆ¶åŒæ¡Œå­¦ç”ŸB
                'fixedSeatStudent'
            ];

            selectors.forEach(id => {
                const select = document.getElementById(id);
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student;
                    option.textContent = student;
                    select.appendChild(option);
                });
            });
        }

        // ç”Ÿæˆå›ºå®šåº§ä½ç½‘æ ¼
        function generateFixedSeatGrid() {
            const grid = document.getElementById('fixedSeatGrid');
            grid.innerHTML = '';

            for (let i = 0; i < 56; i++) {
                const row = Math.floor(i / 8) + 1;
                const col = (i % 8) + 1;
                const seat = document.createElement('div');
                seat.className = 'fixed-seat-item';
                seat.textContent = `${row}è¡Œ${col}åˆ—`;
                seat.dataset.position = i;
                
                // æ£€æŸ¥æ˜¯å¦å·²é€‰ä¸­
                const fixedSeat = settings.fixedSeats.find(f => f.position === i);
                if (fixedSeat) {
                    seat.classList.add('active');
                    seat.textContent = fixedSeat.student;
                }
                
                seat.addEventListener('click', () => selectFixedSeatPosition(i));
                grid.appendChild(seat);
            }
        }

        // é€‰æ‹©å›ºå®šåº§ä½ä½ç½®
        function selectFixedSeatPosition(position) {
            const student = document.getElementById('fixedSeatStudent').value;
            if (!student) {
                showNotification('è¯·å…ˆé€‰æ‹©å­¦ç”Ÿ', 'error');
                return;
            }

            // ç§»é™¤è¯¥å­¦ç”Ÿå·²æœ‰çš„å›ºå®šåº§ä½
            settings.fixedSeats = settings.fixedSeats.filter(f => f.student !== student);
            
            // ç§»é™¤è¯¥ä½ç½®å·²æœ‰çš„å›ºå®šåº§ä½
            settings.fixedSeats = settings.fixedSeats.filter(f => f.position !== position);
            
            // æ·»åŠ æ–°çš„å›ºå®šåº§ä½
            settings.fixedSeats.push({ student, position });
            
            // æ›´æ–°UI
            generateFixedSeatGrid();
            renderRestrictionLists();
        }

        // æ·»åŠ è¡Œé™åˆ¶
        function addRowRestriction() {
            const student = document.getElementById('rowRestrictionStudent').value;
            const row = parseInt(document.getElementById('rowRestrictionRow').value);
            
            if (!student || isNaN(row)) {
                showNotification('è¯·é€‰æ‹©å­¦ç”Ÿå’Œè¡Œå·', 'error');
                return;
            }

            // ç§»é™¤è¯¥å­¦ç”Ÿå·²æœ‰çš„è¡Œé™åˆ¶
            settings.rowRestrictions = settings.rowRestrictions.filter(r => r.student !== student);
            
            // æ·»åŠ æ–°çš„è¡Œé™åˆ¶
            settings.rowRestrictions.push({ student, row });
            
            // æ›´æ–°UI
            renderRestrictionLists();
            document.getElementById('rowRestrictionStudent').value = '';
            document.getElementById('rowRestrictionRow').value = '';
            showNotification('è¡Œé™åˆ¶å·²æ·»åŠ ');
        }

        // æ·»åŠ ç›¸é‚»é™åˆ¶
        function addAdjacentRestriction() {
            const student1 = document.getElementById('adjacentStudent1').value;
            const student2 = document.getElementById('adjacentStudent2').value;
            
            if (!student1 || !student2 || student1 === student2) {
                showNotification('è¯·é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å­¦ç”Ÿ', 'error');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const exists = settings.adjacentRestrictions.some(r => 
                (r.student1 === student1 && r.student2 === student2) || 
                (r.student1 === student2 && r.student2 === student1)
            );
            
            if (exists) {
                showNotification('è¯¥é™åˆ¶å·²å­˜åœ¨', 'error');
                return;
            }

            // æ·»åŠ æ–°çš„ç›¸é‚»é™åˆ¶
            settings.adjacentRestrictions.push({ student1, student2 });
            
            // æ›´æ–°UI
            renderRestrictionLists();
            document.getElementById('adjacentStudent1').value = '';
            document.getElementById('adjacentStudent2').value = '';
            showNotification('ç›¸é‚»é™åˆ¶å·²æ·»åŠ ');
        }

        // æ·»åŠ å‰åæ¡Œé™åˆ¶
        function addFrontBackRestriction() {
            const student1 = document.getElementById('frontBackStudent1').value;
            const student2 = document.getElementById('frontBackStudent2').value;
            
            if (!student1 || !student2 || student1 === student2) {
                showNotification('è¯·é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å­¦ç”Ÿ', 'error');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const exists = settings.frontBackRestrictions.some(r => 
                (r.student1 === student1 && r.student2 === student2) || 
                (r.student1 === student2 && r.student2 === student1)
            );
            
            if (exists) {
                showNotification('è¯¥é™åˆ¶å·²å­˜åœ¨', 'error');
                return;
            }

            // æ·»åŠ æ–°çš„å‰åæ¡Œé™åˆ¶
            settings.frontBackRestrictions.push({ student1, student2 });
            
            // æ›´æ–°UI
            renderRestrictionLists();
            document.getElementById('frontBackStudent1').value = '';
            document.getElementById('frontBackStudent2').value = '';
            showNotification('å‰åæ¡Œé™åˆ¶å·²æ·»åŠ ');
        }

        // æ–°å¢ï¼šæ·»åŠ å¼ºåˆ¶åŒæ¡Œè§„åˆ™
        function addDeskmateRestriction() {
            const student1 = document.getElementById('deskmateStudent1').value;
            const student2 = document.getElementById('deskmateStudent2').value;
            
            if (!student1 || !student2 || student1 === student2) {
                showNotification('è¯·é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å­¦ç”Ÿ', 'error');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const exists = settings.deskmateRestrictions.some(r => 
                (r.student1 === student1 && r.student2 === student2) || 
                (r.student1 === student2 && r.student2 === student1)
            );
            
            if (exists) {
                showNotification('è¯¥åŒæ¡Œè§„åˆ™å·²å­˜åœ¨', 'error');
                return;
            }

            // æ·»åŠ æ–°çš„å¼ºåˆ¶åŒæ¡Œè§„åˆ™
            settings.deskmateRestrictions.push({ student1, student2 });
            
            // æ›´æ–°UI
            renderRestrictionLists();
            document.getElementById('deskmateStudent1').value = '';
            document.getElementById('deskmateStudent2').value = '';
            showNotification('å¼ºåˆ¶åŒæ¡Œè§„åˆ™å·²æ·»åŠ ');
        }

        // æ¸²æŸ“é™åˆ¶åˆ—è¡¨
        function renderRestrictionLists() {
            // æ¸²æŸ“è¡Œé™åˆ¶åˆ—è¡¨
            const rowList = document.getElementById('rowRestrictionList');
            if (rowList) {
                rowList.innerHTML = '';
                settings.rowRestrictions.forEach((r, index) => {
                    const item = document.createElement('div');
                    item.className = 'restriction-item';
                    item.innerHTML = `
                        <span>${r.student} å›ºå®šåœ¨ç¬¬${r.row + 1}è¡Œ</span>
                        <button class="remove-btn" onclick="removeRowRestriction(${index})">åˆ é™¤</button>
                    `;
                    rowList.appendChild(item);
                });
            }

            // æ¸²æŸ“ç›¸é‚»é™åˆ¶åˆ—è¡¨
            const adjacentList = document.getElementById('adjacentRestrictionList');
            if (adjacentList) {
                adjacentList.innerHTML = '';
                settings.adjacentRestrictions.forEach((r, index) => {
                    const item = document.createElement('div');
                    item.className = 'restriction-item';
                    item.innerHTML = `
                        <span>${r.student1} å’Œ ${r.student2} ä¸èƒ½å·¦å³ç›¸é‚»</span>
                        <button class="remove-btn" onclick="removeAdjacentRestriction(${index})">åˆ é™¤</button>
                    `;
                    adjacentList.appendChild(item);
                });
            }

            // æ¸²æŸ“å‰åæ¡Œé™åˆ¶åˆ—è¡¨
            const frontBackList = document.getElementById('frontBackRestrictionList');
            if (frontBackList) {
                frontBackList.innerHTML = '';
                settings.frontBackRestrictions.forEach((r, index) => {
                    const item = document.createElement('div');
                    item.className = 'restriction-item';
                    item.innerHTML = `
                        <span>${r.student1} å’Œ ${r.student2} ä¸èƒ½å‰åç›¸é‚»</span>
                        <button class="remove-btn" onclick="removeFrontBackRestriction(${index})">åˆ é™¤</button>
                    `;
                    frontBackList.appendChild(item);
                });
            }

            // æ–°å¢ï¼šæ¸²æŸ“å¼ºåˆ¶åŒæ¡Œè§„åˆ™åˆ—è¡¨
            const deskmateList = document.getElementById('deskmateRestrictionList');
            if (deskmateList) {
                deskmateList.innerHTML = '';
                settings.deskmateRestrictions.forEach((r, index) => {
                    const item = document.createElement('div');
                    item.className = 'restriction-item';
                    item.innerHTML = `
                        <span>${r.student1} å’Œ ${r.student2} å¿…é¡»ååŒæ¡Œ</span>
                        <button class="remove-btn" onclick="removeDeskmateRestriction(${index})">åˆ é™¤</button>
                    `;
                    deskmateList.appendChild(item);
                });
            }

            // æ¸²æŸ“å›ºå®šåº§ä½åˆ—è¡¨
            const fixedList = document.getElementById('fixedSeatList');
            if (fixedList) {
                fixedList.innerHTML = '';
                settings.fixedSeats.forEach((r, index) => {
                    const row = Math.floor(r.position / 8) + 1;
                    const col = (r.position % 8) + 1;
                    const item = document.createElement('div');
                    item.className = 'restriction-item';
                    item.innerHTML = `
                        <span>${r.student} å›ºå®šåœ¨${row}è¡Œ${col}åˆ—</span>
                        <button class="remove-btn" onclick="removeFixedSeat(${index})">åˆ é™¤</button>
                    `;
                    fixedList.appendChild(item);
                });
            }
        }

        // åˆ é™¤è¡Œé™åˆ¶
        function removeRowRestriction(index) {
            settings.rowRestrictions.splice(index, 1);
            renderRestrictionLists();
            showNotification('è¡Œé™åˆ¶å·²åˆ é™¤');
        }

        // åˆ é™¤ç›¸é‚»é™åˆ¶
        function removeAdjacentRestriction(index) {
            settings.adjacentRestrictions.splice(index, 1);
            renderRestrictionLists();
            showNotification('ç›¸é‚»é™åˆ¶å·²åˆ é™¤');
        }

        // åˆ é™¤å‰åæ¡Œé™åˆ¶
        function removeFrontBackRestriction(index) {
            settings.frontBackRestrictions.splice(index, 1);
            renderRestrictionLists();
            showNotification('å‰åæ¡Œé™åˆ¶å·²åˆ é™¤');
        }

        // æ–°å¢ï¼šåˆ é™¤å¼ºåˆ¶åŒæ¡Œè§„åˆ™
        function removeDeskmateRestriction(index) {
            settings.deskmateRestrictions.splice(index, 1);
            renderRestrictionLists();
            showNotification('å¼ºåˆ¶åŒæ¡Œè§„åˆ™å·²åˆ é™¤');
        }

        // åˆ é™¤å›ºå®šåº§ä½
        function removeFixedSeat(index) {
            settings.fixedSeats.splice(index, 1);
            generateFixedSeatGrid();
            renderRestrictionLists();
            showNotification('å›ºå®šåº§ä½å·²åˆ é™¤');
        }

        // ======================== æ ¸å¿ƒåŠŸèƒ½ ========================
        // ç”Ÿæˆéšæœºåº§ä½ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼Œæ–°å¢å¼ºåˆ¶åŒæ¡Œè§„åˆ™å¤„ç†ï¼‰
        function generateRandomSeats() {
            // åˆ›å»ºåº§ä½æ•°ç»„
            let newSeats = Array(56).fill(null);
            
            // ç¬¬ä¸€æ­¥ï¼šæ”¾ç½®å›ºå®šåº§ä½
            settings.fixedSeats.forEach(fixed => {
                newSeats[fixed.position] = fixed.student;
            });
            
            // ç¬¬äºŒæ­¥ï¼šå¤„ç†å¼ºåˆ¶åŒæ¡Œè§„åˆ™ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
            const deskmatePairs = [...settings.deskmateRestrictions];
            const deskmateStudents = [];
            
            // ä¸ºæ¯å¯¹å¼ºåˆ¶åŒæ¡Œçš„å­¦ç”Ÿåˆ†é…ç›¸é‚»åº§ä½
            deskmatePairs.forEach(pair => {
                const { student1, student2 } = pair;
                
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰å›ºå®šåº§ä½
                const student1Pos = settings.fixedSeats.find(f => f.student === student1)?.position;
                const student2Pos = settings.fixedSeats.find(f => f.student === student2)?.position;
                
                if (student1Pos !== undefined && student2Pos !== undefined) {
                    // ä¸¤ä¸ªå­¦ç”Ÿéƒ½æœ‰å›ºå®šåº§ä½ï¼Œè·³è¿‡
                    deskmateStudents.push(student1, student2);
                    return;
                }
                
                // å¯»æ‰¾å¯ç”¨çš„ç›¸é‚»åº§ä½å¯¹
                const availablePairs = [];
                for (let i = 0; i < 56; i++) {
                    // è·³è¿‡å·²æœ‰å›ºå®šåº§ä½çš„ä½ç½®
                    if (newSeats[i] !== null) continue;
                    
                    // æ£€æŸ¥å³ä¾§æ˜¯å¦æœ‰ç›¸é‚»åº§ä½
                    const col = i % 8;
                    if (col < 7) {
                        const rightPos = i + 1;
                        if (newSeats[rightPos] === null) {
                            availablePairs.push([i, rightPos]);
                        }
                    }
                }
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªåº§ä½å¯¹åˆ†é…ç»™åŒæ¡Œ
                if (availablePairs.length > 0) {
                    const [pos1, pos2] = availablePairs[Math.floor(Math.random() * availablePairs.length)];
                    
                    // éšæœºå†³å®šè°åå·¦è¾¹è°åå³è¾¹
                    if (Math.random() > 0.5) {
                        newSeats[pos1] = student1;
                        newSeats[pos2] = student2;
                    } else {
                        newSeats[pos1] = student2;
                        newSeats[pos2] = student1;
                    }
                    
                    deskmateStudents.push(student1, student2);
                }
            });
            
            // è·å–å‰©ä½™éœ€è¦åˆ†é…çš„å­¦ç”Ÿï¼ˆæ’é™¤å›ºå®šåº§ä½å’Œå¼ºåˆ¶åŒæ¡Œçš„å­¦ç”Ÿï¼‰
            let availableStudents = [...students];
            settings.fixedSeats.forEach(fixed => {
                const idx = availableStudents.indexOf(fixed.student);
                if (idx !== -1) availableStudents.splice(idx, 1);
            });
            deskmateStudents.forEach(student => {
                const idx = availableStudents.indexOf(student);
                if (idx !== -1) availableStudents.splice(idx, 1);
            });
            
            // ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨è¡Œé™åˆ¶ï¼Œæ”¾ç½®æœ‰è¡Œé™åˆ¶çš„å­¦ç”Ÿ
            settings.rowRestrictions.forEach(restriction => {
                const { student, row } = restriction;
                
                // è·³è¿‡å·²åˆ†é…çš„å­¦ç”Ÿ
                if (!availableStudents.includes(student)) return;
                
                // æ‰¾åˆ°è¯¥è¡Œçš„ç©ºä½ç½®
                const rowStart = row * 8;
                const rowEnd = rowStart + 8;
                const emptyPositions = [];
                
                for (let i = rowStart; i < rowEnd; i++) {
                    if (newSeats[i] === null) {
                        emptyPositions.push(i);
                    }
                }
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®æ”¾ç½®
                if (emptyPositions.length > 0) {
                    const randomPos = emptyPositions[Math.floor(Math.random() * emptyPositions.length)];
                    newSeats[randomPos] = student;
                    
                    // ä»å¯ç”¨å­¦ç”Ÿåˆ—è¡¨ä¸­ç§»é™¤
                    const idx = availableStudents.indexOf(student);
                    if (idx !== -1) availableStudents.splice(idx, 1);
                }
            });
            
            // ç¬¬å››æ­¥ï¼šéšæœºåˆ†é…å‰©ä½™å­¦ç”Ÿï¼ŒåŒæ—¶åº”ç”¨ç›¸é‚»å’Œå‰åæ¡Œé™åˆ¶
            while (availableStudents.length > 0) {
                // éšæœºé€‰æ‹©ä¸€ä¸ªç©ºä½ç½®
                const emptyPositions = [];
                for (let i = 0; i < 56; i++) {
                    if (newSeats[i] === null) emptyPositions.push(i);
                }
                
                if (emptyPositions.length === 0) break;
                
                const randomPos = emptyPositions[Math.floor(Math.random() * emptyPositions.length)];
                let placed = false;
                
                // å°è¯•ä¸ºè¯¥ä½ç½®æ‰¾åˆ°åˆé€‚çš„å­¦ç”Ÿ
                for (let i = 0; i < availableStudents.length; i++) {
                    const student = availableStudents[i];
                    
                    // æ£€æŸ¥ç›¸é‚»é™åˆ¶å’Œå‰åæ¡Œé™åˆ¶
                    if (!checkAdjacentRestriction(newSeats, randomPos, student) &&
                        !checkFrontBackRestriction(newSeats, randomPos, student)) {
                        
                        newSeats[randomPos] = student;
                        availableStudents.splice(i, 1);
                        placed = true;
                        break;
                    }
                }
                
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å­¦ç”Ÿï¼Œå¼ºåˆ¶æ”¾ç½®ç¬¬ä¸€ä¸ªå­¦ç”Ÿï¼ˆé¿å…æ­»å¾ªç¯ï¼‰
                if (!placed && availableStudents.length > 0) {
                    newSeats[randomPos] = availableStudents[0];
                    availableStudents.shift();
                }
            }
            
            // æ›´æ–°å½“å‰åº§ä½å¹¶æ¸²æŸ“
            currentSeats = newSeats;
            renderSeats();
        }

        // æ£€æŸ¥ç›¸é‚»é™åˆ¶
        function checkAdjacentRestriction(seats, position, student) {
            // è·å–å·¦å³é‚»å±…
            const leftPos = position - 1;
            const rightPos = position + 1;
            const currentCol = position % 8;
            
            // æ£€æŸ¥å·¦é‚»å±…
            if (currentCol > 0 && seats[leftPos]) {
                const neighbor = seats[leftPos];
                if (settings.adjacentRestrictions.some(r => 
                    (r.student1 === student && r.student2 === neighbor) || 
                    (r.student1 === neighbor && r.student2 === student)
                )) {
                    return true; // è¿åé™åˆ¶
                }
            }
            
            // æ£€æŸ¥å³é‚»å±…
            if (currentCol < 7 && seats[rightPos]) {
                const neighbor = seats[rightPos];
                if (settings.adjacentRestrictions.some(r => 
                    (r.student1 === student && r.student2 === neighbor) || 
                    (r.student1 === neighbor && r.student2 === student)
                )) {
                    return true; // è¿åé™åˆ¶
                }
            }
            
            return false; // ç¬¦åˆé™åˆ¶
        }

        // æ£€æŸ¥å‰åæ¡Œé™åˆ¶
        function checkFrontBackRestriction(seats, position, student) {
            // è·å–å‰åé‚»å±…
            const frontPos = position - 8;
            const backPos = position + 8;
            
            // æ£€æŸ¥å‰é‚»å±…
            if (frontPos >= 0 && seats[frontPos]) {
                const neighbor = seats[frontPos];
                if (settings.frontBackRestrictions.some(r => 
                    (r.student1 === student && r.student2 === neighbor) || 
                    (r.student1 === neighbor && r.student2 === student)
                )) {
                    return true; // è¿åé™åˆ¶
                }
            }
            
            // æ£€æŸ¥åé‚»å±…
            if (backPos < 56 && seats[backPos]) {
                const neighbor = seats[backPos];
                if (settings.frontBackRestrictions.some(r => 
                    (r.student1 === student && r.student2 === neighbor) || 
                    (r.student1 === neighbor && r.student2 === student)
                )) {
                    return true; // è¿åé™åˆ¶
                }
            }
            
            return false; // ç¬¦åˆé™åˆ¶
        }

        // æ¸²æŸ“åº§ä½ï¼ˆç§»é™¤åŒæ¡Œæ ‡è®°ï¼Œä»…ä¿ç•™å›ºå®šåº§ä½æ ‡è®°ï¼‰
        function renderSeats() {
            const container = document.getElementById('seatContainer');
            container.innerHTML = '';

            currentSeats.forEach((student, index) => {
                const seat = document.createElement('div');
                seat.className = 'seat';
                
                // ä»…æ ‡è®°å›ºå®šåº§ä½
                if (settings.fixedSeats.some(f => f.position === index)) {
                    seat.classList.add('fixed-seat');
                }
                
                seat.textContent = student || '';
                seat.addEventListener('click', () => showStudentHistory(student));
                container.appendChild(seat);
            });
        }

        // ä¿å­˜å½“å‰åº§ä½
        function saveCurrentSeats() {
            const timestamp = new Date().toISOString();
            const seatData = {
                id: Date.now(),
                timestamp: timestamp,
                seats: [...currentSeats],
                settings: JSON.parse(JSON.stringify(settings))
            };

            history.unshift(seatData);
            if (history.length > 10) {
                history = history.slice(0, 10);
            }

            saveHistory();
            showNotification('åº§ä½è¡¨å·²ä¿å­˜');
        }

        // ======================== å¯¼å‡ºé”å®šè§„åˆ™çš„ç½‘é¡µ ========================
        function exportLockedHtml() {
            if (LOCKED_SETTINGS.isLocked) {
                showNotification('å½“å‰å·²æ˜¯é”å®šç‰ˆæœ¬ï¼Œæ— æ³•å¯¼å‡º', 'error');
                return;
            }
            
            // è¯»å–å½“å‰HTMLå†…å®¹
            let htmlContent = document.documentElement.outerHTML;
            
            // åˆ›å»ºé”å®šçš„è®¾ç½®å¯¹è±¡ï¼ˆåŒ…å«æ–°å¢çš„å¼ºåˆ¶åŒæ¡Œè§„åˆ™ï¼‰
            const lockedSettings = {
                isLocked: true,
                rowRestrictions: [...settings.rowRestrictions],
                adjacentRestrictions: [...settings.adjacentRestrictions],
                frontBackRestrictions: [...settings.frontBackRestrictions],
                deskmateRestrictions: [...settings.deskmateRestrictions], // æ–°å¢
                fixedSeats: [...settings.fixedSeats]
            };
            
            // å°†LOCKED_SETTINGSæ›¿æ¢ä¸ºå®é™…çš„é”å®šè®¾ç½®
            const lockedSettingsString = JSON.stringify(lockedSettings, null, 4);
            htmlContent = htmlContent.replace(
                /const LOCKED_SETTINGS = \{[\s\S]*?\};/,
                `const LOCKED_SETTINGS = ${lockedSettingsString};`
            );
            
            // åˆ›å»ºBlobå¹¶ä¸‹è½½
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `éšæœºåº§ä½ç”Ÿæˆå™¨_è§„åˆ™é”å®šç‰ˆ_${new Date().getTime()}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // æ˜¾ç¤ºå¯¼å‡ºæˆåŠŸå¼¹çª—
            document.getElementById('exportModal').style.display = 'flex';
            lucide.createIcons();
        }

        // ======================== å†å²è®°å½•å’Œå¼¹çª—ç®¡ç† ========================
        // æ˜¾ç¤ºå­¦ç”Ÿå†å²è®°å½•
        function showStudentHistory(student) {
            if (!student) return;

            const modal = document.getElementById('studentModal');
            const title = document.getElementById('studentModalTitle');
            const content = document.getElementById('studentHistory');

            title.textContent = `${student} - å†å²è®°å½•`;
            content.innerHTML = '';

            // æŸ¥æ‰¾è¯¥å­¦ç”Ÿçš„æ‰€æœ‰å†å²è®°å½•
            const studentHistory = [];
            history.forEach(record => {
                const seatIndex = record.seats.indexOf(student);
                if (seatIndex !== -1) {
                    studentHistory.push({
                        timestamp: record.timestamp,
                        seatPosition: seatIndex + 1,
                        row: Math.floor(seatIndex / 8) + 1,
                        col: (seatIndex % 8) + 1
                    });
                }
            });

            if (studentHistory.length === 0) {
                content.innerHTML = '<p class="text-gray-500">æš‚æ— å†å²è®°å½•</p>';
            } else {
                studentHistory.forEach(record => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `
                        <div class="font-semibold">${new Date(record.timestamp).toLocaleString('zh-CN')}</div>
                        <div class="text-gray-600">ä½ç½®: ${record.seatPosition} (ç¬¬${record.row}è¡Œç¬¬${record.col}åˆ—)</div>
                    `;
                    content.appendChild(item);
                });
            }

            modal.style.display = 'flex';
        }

        // å…³é—­å­¦ç”Ÿè¯¦æƒ…å¼¹çª—
        function closeStudentModal() {
            document.getElementById('studentModal').style.display = 'none';
        }

        // æ˜¾ç¤ºå†å²è®°å½•å¼¹çª—
        function showHistoryModal() {
            const modal = document.getElementById('historyModal');
            const list = document.getElementById('historyList');
            list.innerHTML = '';

            if (history.length === 0) {
                list.innerHTML = '<p class="text-gray-500">æš‚æ— å†å²è®°å½•</p>';
            } else {
                history.forEach(record => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `
                        <div class="font-semibold">${new Date(record.timestamp).toLocaleString('zh-CN')}</div>
                        <div class="text-gray-600">åº§ä½è¡¨ #${record.id}</div>
                    `;
                    item.addEventListener('click', () => loadHistoryRecord(record));
                    list.appendChild(item);
                });
            }

            modal.style.display = 'flex';
        }

        // å…³é—­å†å²è®°å½•å¼¹çª—
        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
        }

        // åŠ è½½å†å²è®°å½•
        function loadHistoryRecord(record) {
            currentSeats = [...record.seats];
            if (!LOCKED_SETTINGS.isLocked) {
                settings = JSON.parse(JSON.stringify(record.settings));
                renderRestrictionLists();
                generateFixedSeatGrid();
            }
            renderSeats();
            closeHistoryModal();
            showNotification('å·²åŠ è½½å†å²åº§ä½è¡¨');
        }

        // æ˜¾ç¤ºè®¾ç½®å¼¹çª—
        function showSettingsModal() {
            if (LOCKED_SETTINGS.isLocked) {
                showNotification('è®¾ç½®åŠŸèƒ½ä¸å¯ç”¨', 'error');
                return;
            }
            
            document.getElementById('settingsModal').style.display = 'flex';
            document.getElementById('passwordPrompt').style.display = 'block';
            document.getElementById('settingsContent').style.display = 'none';
            document.getElementById('passwordInput').value = '';
        }

        // å…³é—­è®¾ç½®å¼¹çª—
        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        // å…³é—­å¯¼å‡ºæˆåŠŸå¼¹çª—
        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        // æ£€æŸ¥å¯†ç 
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'passwordtest') {
                document.getElementById('passwordPrompt').style.display = 'none';
                document.getElementById('settingsContent').style.display = 'block';
            } else {
                showNotification('å¯†ç é”™è¯¯', 'error');
            }
        }

        // ä¿å­˜æ‰€æœ‰è®¾ç½®
        function saveAllSettings() {
            saveSettings();
            closeSettingsModal();
            generateRandomSeats();
            showNotification('æ‰€æœ‰è®¾ç½®å·²ä¿å­˜å¹¶ç”Ÿæ•ˆ');
        }

        // ======================== æœ¬åœ°å­˜å‚¨ ========================
        // ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
        function saveSettings() {
            if (!LOCKED_SETTINGS.isLocked) {
                localStorage.setItem('seatGeneratorSettings', JSON.stringify(settings));
            }
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®¾ç½®
        function loadSettings() {
            const saved = localStorage.getItem('seatGeneratorSettings');
            if (saved) {
                settings = JSON.parse(saved);
                // å…¼å®¹æ—§ç‰ˆæœ¬æ•°æ®ï¼Œæ·»åŠ ç¼ºå¤±çš„å¼ºåˆ¶åŒæ¡Œè§„åˆ™å­—æ®µ
                if (!settings.deskmateRestrictions) {
                    settings.deskmateRestrictions = [];
                }
            }
        }

        // ä¿å­˜å†å²è®°å½•åˆ°æœ¬åœ°å­˜å‚¨
        function saveHistory() {
            localStorage.setItem('seatGeneratorHistory', JSON.stringify(history));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const saved = localStorage.getItem('seatGeneratorHistory');
            if (saved) {
                history = JSON.parse(saved);
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ======================== äº‹ä»¶ç›‘å¬ ========================
        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('generateBtn')) {
                document.getElementById('generateBtn').addEventListener('click', generateRandomSeats);
            }
            if (document.getElementById('saveBtn')) {
                document.getElementById('saveBtn').addEventListener('click', saveCurrentSeats);
            }
            if (document.getElementById('historyBtn')) {
                document.getElementById('historyBtn').addEventListener('click', showHistoryModal);
            }
            if (document.getElementById('settingsBtn')) {
                document.getElementById('settingsBtn').addEventListener('click', showSettingsModal);
            }
            if (document.getElementById('exportBtn')) {
                document.getElementById('exportBtn').addEventListener('click', exportLockedHtml);
            }

            // ç‚¹å‡»å¼¹çª—å¤–åŒºåŸŸå…³é—­å¼¹çª—
            window.addEventListener('click', function(event) {
                const modals = ['historyModal', 'settingsModal', 'studentModal', 'exportModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal && event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey || event.metaKey) {
                    switch (event.key) {
                        case 'g':
                            event.preventDefault();
                            generateRandomSeats();
                            break;
                        case 's':
                            event.preventDefault();
                            saveCurrentSeats();
                            break;
                        case 'h':
                            event.preventDefault();
                            showHistoryModal();
                            break;
                    }
                }
                
                if (event.key === 'Escape') {
                    closeHistoryModal();
                    closeSettingsModal();
                    closeStudentModal();
                    closeExportModal();
                }
            });
        });
    </script>


</body></html>
